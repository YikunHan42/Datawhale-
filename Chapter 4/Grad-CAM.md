# Grad-CAM

[Grad-CAM: Visual Explanations from Deep Networks via Gradient-based Localization](https://arxiv.org/pdf/1610.02391.pdf)

CAM中，如果没有GAP层，需把全连接层替换为GAP层，再重新训练模型（对于Alexnet等则无法适用）

## CAM缺点

1. 必须得有GAP层，否则得修改模型结构后重新训练
2. 智能分析最后一层卷积核输出，无法分析中间层
3. 仅限图像分类任务

## 结构

![image-20221220023328640](.\1.png)

兼容各种输入：

![image-20221220023418044](.\2.png)

## 实验结果

网络注意力分析

![image-20221220023622689](.\3.png)

解释被网络预测错误的图片：

![image-20221220023735270](.\4.png)

其他任务

![image-20221220023913985](.\5.png)

发现数据集中的偏见（性别因素）

![image-20221220024012267](.\6.png)

最无关的区域

![image-20221220024229316](.\7.png)

## 应用

气胸病灶检测![image-20221220024317354](.\8.png)

## 讨论

优点：

1. 无需GAP层，无需修改模型结构，无需重新训练
2. 可分析任意中间层
3. 数学上是原生CAM的推广
4. 细粒度图像分类、Machine Teaching

缺点：

1. 图像上有多个同类物体时，只能画出一块热力图
2. 不同位置的梯度值，GAP平均值后，影响是相同的
3. 梯度饱和、梯度消失、梯度噪声
4. 权重大的channel，不一定对类别预测分数贡献大
5. 只考虑从后往前的反向传播梯度，没考虑前向预测的影响（求偏导数得出）
6. 深层生成的粗粒度热力图和浅层生成的细粒度热力图 都不够精准

## 后续算法

### Grad-CAM++

解决前两个问题：

![image-20221220024807962](.\9.png)

添加二阶和三阶偏导数

![image-20221220024841508](.\10.png)

### ScoreCAM

解决三四五的问题

![image-20221220024953173](.\11.png)

![image-20221220025056687](.\12.png)

### LayerCAM

解决第六个问题

基本可以达到图像分割的精度

![image-20221220025239621](.\13.png)

可以适用于工业缺陷检测，找到有缺陷的图片（弱监督的方法进行标注）

![image-20221220025344992](.\14.png)